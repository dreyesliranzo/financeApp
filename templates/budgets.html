{% extends "base.html" %}
{% block content %}
<div class="flex flex-wrap items-center justify-between gap-3 mb-6">
  <div>
    <h2 class="text-3xl font-bold text-white">Budgets</h2>
    <p class="text-sm text-text-muted">Set limits and track your progress.</p>
  </div>
  <a href="{{ url_for('main.dashboard') }}" class="px-3 py-2 rounded-xl border border-white/10 text-white hover:bg-white/5">Back to Dashboard</a>
</div>

<div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
  <div class="rounded-2xl border border-white/5 bg-slate-900/70 shadow-card p-6">
    <h5 class="text-lg font-semibold text-white mb-4">New Budget</h5>
    <form method="POST" class="space-y-4">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <label class="text-sm text-white font-semibold flex flex-col gap-1">
          Period Start
          <input type="date" name="period_start" class="w-full rounded-xl bg-slate-900/60 border border-white/10 px-3 py-2 text-sm focus:ring-2 focus:ring-primary" required>
        </label>
        <label class="text-sm text-white font-semibold flex flex-col gap-1">
          Period End
          <input type="date" name="period_end" class="w-full rounded-xl bg-slate-900/60 border border-white/10 px-3 py-2 text-sm focus:ring-2 focus:ring-primary" required>
        </label>
      </div>
      <label class="text-sm text-white font-semibold flex flex-col gap-1">
        Category (optional)
        <select name="category" class="w-full rounded-xl bg-slate-900/60 border border-white/10 px-3 py-2 text-sm focus:ring-2 focus:ring-primary">
          <option value="">All categories</option>
          {% for cat in categories %}
            <option value="{{ cat }}">{{ cat }}</option>
          {% endfor %}
        </select>
      </label>
      <label class="text-sm text-white font-semibold flex flex-col gap-1">
        Amount
        <input type="number" step="0.01" min="0" name="amount" class="w-full rounded-xl bg-slate-900/60 border border-white/10 px-3 py-2 text-sm focus:ring-2 focus:ring-primary" required>
      </label>
      <button class="w-full px-4 py-2 rounded-xl bg-primary text-white font-semibold shadow-button hover:brightness-110">Save Budget</button>
    </form>
  </div>

  <div class="space-y-4">
    <div class="rounded-2xl border border-white/5 bg-slate-900/70 shadow-card p-5">
      <div class="flex items-center justify-between mb-2">
        <h5 class="text-lg font-semibold text-white mb-0">Your Budgets</h5>
        <small class="text-text-muted">Current period progress below.</small>
      </div>
      {% if budgets %}
        <div class="divide-y divide-white/5">
          {% for budget in budgets %}
          <div class="py-3 flex items-center justify-between">
            <div>
              <div class="text-sm font-semibold text-white">{{ budget.category or "All categories" }}</div>
              <div class="text-xs text-text-muted">{{ budget.period_start }} → {{ budget.period_end }}</div>
            </div>
            <div class="text-right space-y-2">
              <div class="text-sm font-bold">${{ '%.2f'|format(budget.amount) }}</div>
              <div class="flex gap-2 justify-end">
                <a href="{{ url_for('main.edit_budget', budget_id=budget.id) }}" class="px-3 py-1 rounded-lg border border-white/10 text-xs hover:bg-white/5">Edit</a>
                <form action="{{ url_for('main.delete_budget', budget_id=budget.id) }}" method="post" onsubmit="return confirm('Delete this budget?');">
                  <button class="px-3 py-1 rounded-lg bg-danger text-white text-xs hover:brightness-110">Delete</button>
                </form>
              </div>
            </div>
          </div>
          {% endfor %}
        </div>
      {% else %}
        <p class="text-sm text-text-muted mb-0">No budgets yet.</p>
      {% endif %}
    </div>

    <div class="rounded-2xl border border-white/5 bg-slate-900/70 shadow-card p-5">
      <h6 class="text-base font-semibold text-white mb-3">Current Progress</h6>
      {% if progress %}
        <div class="space-y-3">
          {% for item in progress %}
          {% set bar_class = 'from-emerald-400 to-sky-400' %}
          {% if item.percent > 100 %}{% set bar_class = 'from-red-400 to-rose-500' %}{% elif item.percent > 85 %}{% set bar_class = 'from-amber-300 to-orange-400' %}{% endif %}
          <div class="space-y-2">
            <div class="flex items-center justify-between">
              <div>
                <div class="text-sm font-semibold text-white">{{ item.budget.category or "All categories" }}</div>
                <div class="text-xs text-text-muted">{{ item.budget.period_start }} → {{ item.budget.period_end }}</div>
              </div>
              <div class="text-right">
                <div class="text-sm font-bold {% if item.percent > 100 %}text-danger{% elif item.percent > 85 %}text-warning{% else %}text-success{% endif %}">{{ '%.0f'|format(item.percent) }}%</div>
                <div class="text-xs text-text-muted">${{ '%.2f'|format(item.spent) }} / ${{ '%.2f'|format(item.budget.amount) }}</div>
              </div>
            </div>
            <div class="w-full h-2 rounded-full bg-white/10">
              <div class="h-2 rounded-full bg-gradient-to-r {{ bar_class }}" style="width: {{ item.percent if item.percent < 100 else 100 }}%"></div>
            </div>
          </div>
          {% endfor %}
        </div>
      {% else %}
        <p class="text-sm text-text-muted mb-0">No active budgets for today.</p>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}
